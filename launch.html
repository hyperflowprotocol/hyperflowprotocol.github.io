<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>SocialX - Launch</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script><style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* Light Theme (Default) */
        .light-theme {
            --bg-color: #fafafa;
            --text-color: #1a1a1a;
            --card-bg: #ffffff;
            --border-color: #e1e5e9;
            --header-bg: #ffffff;
            --button-bg: linear-gradient(135deg, #6b7280, #4b5563);
        }
        
        /* Dark Theme */
        .dark-theme {
            --bg-color: #0a0a0a;
            --text-color: #ffffff;
            --card-bg: #1a1a1a;
            --border-color: #333333;
            --header-bg: #1a1a1a;
            --button-bg: linear-gradient(135deg, #333333, #1a1a1a);
        }
        
        /* Apply theme variables to all major elements */
        .dark-theme .info-card, 
        .dark-theme .launch-section,
        .dark-theme .wallet-info,
        .dark-theme .points-item,
        .dark-theme .market-card,
        .dark-theme .account-card,
        .dark-theme .trade-card,
        .dark-theme .stats-grid,
        .dark-theme .market-overview {
            background: #1a1a1a !important;
            color: #ffffff !important;
            border: 1px solid #333333 !important;
        }
        
        /* Target ALL cards and containers in dark theme */
        .dark-theme div[style*="background"],
        .dark-theme .stats-container,
        .dark-theme .content-card,
        .dark-theme div {
            background: #1a1a1a !important;
            color: #ffffff !important;
        }
        
        .dark-theme h1, .dark-theme h2, .dark-theme h3, .dark-theme h4, .dark-theme h5 {
            color: #ffffff !important;
        }
        
        /* Header text and all text in dark theme */
        .dark-theme .header h1, 
        .dark-theme .header,
        .dark-theme p,
        .dark-theme span,
        .dark-theme div,
        .dark-theme strong {
            color: #ffffff !important;
        }
        
        /* Specifically target "Social X" text - super aggressive */
        .dark-theme h1 {
            color: #ffffff !important;
        }
        
        /* Target ALL possible header text locations */
        .dark-theme .header *,
        .dark-theme .header h1,
        .dark-theme .header .title,
        .dark-theme .header span,
        .dark-theme .header div,
        .dark-theme h1,
        .dark-theme h1 * {
            color: #ffffff !important;
        }
        
        /* Override any colored text in header */
        .dark-theme .header [style*="color"],
        .dark-theme h1[style*="color"] {
            color: #ffffff !important;
        }
        
        .dark-theme .nav-link {
            color: var(--text-color) !important;
        }
        
        /* Make all cards and text respect theme */
        .info-card {
            background: var(--card-bg, white) !important;
            color: var(--text-color, #1a1a1a) !important;
            border: 1px solid var(--border-color, #e6e6e6) !important;
        }
        
        .launch-section {
            background: var(--card-bg, white) !important;
            color: var(--text-color, #1a1a1a) !important;
            border: 1px solid var(--border-color, #e6e6e6) !important;
        }
        
        .wallet-info, .points-item {
            background: var(--card-bg, white) !important;
            color: var(--text-color, #1a1a1a) !important;
        }
        
        /* Wallet address box styling */
        .wallet-address-box {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
        }
        
        .wallet-address-box label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 6px;
            display: block;
        }
        
        .address-display {
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
            background: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 8px 12px;
            word-break: break-all;
            color: #374151;
        }
        
        /* Dark theme for wallet address */
        .dark-theme .wallet-address-box {
            background: #2d3748 !important;
            border-color: #4a5568 !important;
        }
        
        .dark-theme .wallet-address-box label {
            color: #cbd5e0 !important;
        }
        
        .dark-theme .address-display {
            background: #1a202c !important;
            border-color: #4a5568 !important;
            color: #e2e8f0 !important;
        }
        
        /* Header styling */
        .header {
            background: var(--header-bg, white) !important;
            border-bottom: 1px solid var(--border-color, #e1e5e9) !important;
        }
        
        .dark-theme .header {
            background: #1a1a1a !important;
            color: #ffffff !important;
        }
        
        /* Force header text to white */
        .dark-theme .header h1,
        .dark-theme .header .logo,
        .dark-theme .header .title {
            color: #ffffff !important;
        }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif; 
            background: var(--bg-color, #fafafa); 
            color: var(--text-color, #1a1a1a);
            transition: background-color 0.3s ease, color 0.3s ease; 
            line-height: 1.6;
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 120px 20px 100px 20px;
            background: var(--bg-color, #fafafa);
        }
        
        h1 {
            font-size: 2rem;
            font-weight: 600;
            color: #1a1a1a;
            margin-bottom: 32px;
            letter-spacing: -0.02em;
        }
        
        h2 {
            font-size: 1.25rem;
            font-weight: 500;
            color: #1a1a1a;
            margin-bottom: 16px;
            letter-spacing: -0.01em;
        }
        
        .header {
            background: #ffffff;
            border-bottom: 1px solid #e1e5e9;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 64px;
        }
        
        .connect-btn {
            background: #1a1a1a;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 24px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .connect-btn:hover {
            background: #333;
            transform: translateY(-1px);
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--header-bg, rgba(255, 255, 255, 0.95));
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color, #e1e5e9);
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding: 12px 0;
            z-index: 1000;
            width: 100%;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 16px;
            text-decoration: none;
            color: var(--text-color, #6b7280);
            transition: all 0.2s ease;
            flex: 1;
            max-width: 120px;
            border-radius: 12px;
        }
        
        .nav-item:hover {
            color: var(--text-color, #1a1a1a);
            background: rgba(0, 0, 0, 0.04);
        }
        
        .dark-theme .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        /* All text elements in dark theme - more specific */
        .dark-theme * {
            color: #ffffff !important;
        }
        
        /* Force all backgrounds to dark in dark theme */
        .dark-theme div,
        .dark-theme section,
        .dark-theme article,
        .dark-theme main {
            background-color: #1a1a1a !important;
        }
        
        /* Override any white backgrounds AND borders */
        .dark-theme [style*="background: white"],
        .dark-theme [style*="background-color: white"],
        .dark-theme [style*="background:#fff"],
        .dark-theme [style*="background-color:#fff"] {
            background: #1a1a1a !important;
        }
        
        /* Fix ALL white borders - super aggressive */
        .dark-theme [style*="border: 1px solid white"],
        .dark-theme [style*="border: 1px solid #fff"],
        .dark-theme [style*="border-color: white"],
        .dark-theme [style*="border: white"],
        .dark-theme [style*="border:white"],
        .dark-theme [style*="border:#fff"],
        .dark-theme [style*="border-color:#fff"] {
            border-color: #333333 !important;
            border: 1px solid #333333 !important;
        }
        
        /* Override ANY element with borders in dark theme */
        .dark-theme * {
            border-color: #333333 !important;
        }
        
        /* Force all borders to be dark */
        .dark-theme div,
        .dark-theme section,
        .dark-theme article {
            border-color: #333333 !important;
        }
        
        /* Except for specific colored elements */
        .dark-theme .price-change.positive {
            color: #10b981 !important;
        }
        
        .dark-theme .price-change.negative {
            color: #ef4444 !important;
        }
        
        /* Chart styling for both themes - yellow for visibility and growth indication */
        .chart-line,
        .chart-dot,
        .performance-chart circle,
        .performance-chart path {
            stroke: #fbbf24 !important; /* Yellow for growth */
            fill: #fbbf24 !important;
        }
        
        /* Dark theme chart adjustments */
        .dark-theme .chart-line,
        .dark-theme .chart-dot,
        .dark-theme .performance-chart circle,
        .dark-theme .performance-chart path {
            stroke: #fbbf24 !important; /* Bright yellow for dark background */
            fill: #fbbf24 !important;
        }
        
        /* Light theme chart - slightly darker yellow */
        .light-theme .chart-line,
        .light-theme .chart-dot,
        .light-theme .performance-chart circle,
        .light-theme .performance-chart path {
            stroke: #f59e0b !important; /* Darker yellow for light background */
            fill: #f59e0b !important;
        }
        
        /* SUPER AGGRESSIVE CHART COLOR OVERRIDE - target ONLY chart elements */
        .dark-theme #pnlChart + svg circle,
        .dark-theme #pnlChart + svg path,
        .dark-theme canvas#pnlChart,
        .dark-theme .chart-container svg circle,
        .dark-theme .chart-container svg path,
        .dark-theme [stroke="#3b82f6"],
        .dark-theme [stroke="blue"],
        .dark-theme [fill="#3b82f6"],
        .dark-theme [fill="blue"] {
            stroke: #fbbf24 !important;
            fill: #fbbf24 !important;
        }
        
        /* Fix chart container white borders */
        .dark-theme canvas,
        .dark-theme svg,
        .dark-theme .chart-container,
        .dark-theme [style*="border"] {
            border: 1px solid #333333 !important;
            background: #1a1a1a !important;
        }
        
        /* NUCLEAR SOCIAL X TEXT FIX */
        body.dark-theme h1,
        html.dark-theme h1,
        .dark-theme > h1,
        [data-theme="dark"] h1,
        .dark-theme h1[style*="color"] {
            color: #ffffff !important;
        }
        
        /* Fix logo text "Social" specifically */
        .logo-text {
            color: #000000; /* Default light theme */
        }
        
        .dark-theme .logo-text {
            color: #ffffff !important; /* Dark theme override */
        }
        
        /* Keep X logo and navigation icons NORMAL colors - not yellow */
        .dark-theme .logo-section svg,
        .dark-theme .header svg,
        .dark-theme .nav-icon,
        .dark-theme .bottom-nav svg {
            fill: #ffffff !important; /* White in dark theme */
            stroke: #ffffff !important;
        }
        
        /* Light theme - normal black icons */
        .logo-section svg,
        .header svg,
        .nav-icon,
        .bottom-nav svg {
            fill: #000000; /* Black in light theme */
            stroke: #000000;
        }
        
        /* Fix ALL black text elements in dark theme */
        .dark-theme .stat-label,
        .dark-theme .stat-value,
        .dark-theme .points-desc,
        .dark-theme .points-amount,
        .dark-theme .points-total,
        .dark-theme .referral-label,
        .dark-theme .ref-label,
        .dark-theme .ref-value,
        .dark-theme .wallet-info div,
        .dark-theme .session-info div {
            color: #ffffff !important;
        }
        
        /* BUTTON STYLING FOR BOTH THEMES */
        /* Dark theme buttons - DARK background with WHITE text */
        .dark-theme .connect-btn,
        .dark-theme .launch-btn,
        .dark-theme .copy-btn,
        .dark-theme .retry-btn,
        .dark-theme .btn,
        .dark-theme button {
            background: #333333 !important;
            color: #ffffff !important;
            border: 1px solid #555555 !important;
        }
        
        .dark-theme .connect-btn:hover,
        .dark-theme .launch-btn:hover:not(:disabled),
        .dark-theme .copy-btn:hover,
        .dark-theme .retry-btn:hover,
        .dark-theme .btn:hover,
        .dark-theme button:hover:not(:disabled) {
            background: #555555 !important;
            color: #ffffff !important;
        }
        
        /* Light theme buttons */
        .connect-btn,
        .launch-btn,
        .copy-btn,
        .retry-btn,
        .btn,
        button {
            background: #1a1a1a;
            color: #ffffff;
            border: 1px solid #1a1a1a;
        }
        
        .connect-btn:hover,
        .launch-btn:hover:not(:disabled),
        .copy-btn:hover,
        .retry-btn:hover,
        .btn:hover,
        button:hover:not(:disabled) {
            background: #333333;
            color: #ffffff;
        }
        
        .nav-icon {
            margin-bottom: 4px;
            opacity: 0.8;
        }
        
        .nav-label {
            font-size: 11px;
            font-weight: 500;
        }
        </style>
</head>
<body data-page="/launch">
    
    <script>
        // Global navigation function available on all pages
        function navigateToPage(path) {
            console.log('🧭 Navigating to:', path);
            
            // Hash-based navigation for single-page switching
            const targetSection = path.replace('/', '');
            
            // Use hash navigation instead of redirects
            if (targetSection === 'portfolio') {
                window.location.hash = '#portfolio';
                showSection('portfolio');
            } else if (targetSection === 'launch') {
                window.location.hash = '#launch'; 
                showSection('launch');
            } else if (targetSection === 'markets') {
                window.location.hash = '#markets';
                showSection('markets');
            } else {
                // For other paths, navigate normally
                window.location.href = path;
            }
        }
        
        function showSection(section) {
            console.log('📋 Switching to section:', section);
            
            // Find and hide all main content containers
            const allSections = document.querySelectorAll('.main-content, .portfolio-content, .launch-content, .markets-content, main');
            allSections.forEach(el => {
                if (el) el.style.display = 'none';
            });
            
            // Show the target section based on current page structure
            if (section === 'portfolio') {
                // Load portfolio content dynamically
                document.body.innerHTML = `
                    <div id="portfolio-section" style="display: block;">
                        <h1>📊 Portfolio</h1>
                        <p>Your portfolio content here...</p>
                        <button onclick="navigateToPage('/markets')">Back to Markets</button>
                        <button onclick="navigateToPage('/launch')">Go to Launch</button>
                    </div>
                `;
            } else if (section === 'launch') {
                // Load launch content dynamically  
                document.body.innerHTML = `
                    <div id="launch-section" style="display: block;">
                        <h1>🚀 Launch</h1>
                        <p>Launch your account content here...</p>
                        <button onclick="navigateToPage('/markets')">Back to Markets</button>
                        <button onclick="navigateToPage('/portfolio')">Go to Portfolio</button>
                    </div>
                `;
            } else {
                // Default to markets - reload page content
                window.location.href = '/';
            }
            
            console.log(`✅ Switched to ${section} section`);
        }
        
        // Handle hash changes for back/forward navigation
        window.addEventListener('hashchange', function() {
            const hash = window.location.hash.substring(1);
            if (hash) {
                showSection(hash);
            }
        });
        
        // Handle initial hash on page load
        window.addEventListener('load', function() {
            const hash = window.location.hash.substring(1);
            if (hash && (hash === 'portfolio' || hash === 'launch')) {
                showSection(hash);
            }
        });
    </script>
    
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div style="display: flex; align-items: center; gap: 4px; background: transparent !important;">
                    <span class="logo-text" style="font-size: 2rem; font-weight: 400;">Social</span>
                    <svg width="32" height="32" viewBox="0 0 24 24" style="margin-top: -2px;">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" fill="#000000"/>
                    </svg>
                </div>
            </div>
            
            <div class="auth-section">
                <button class="connect-btn" id="main-connect-btn">
                    <span style="display: flex; align-items: center; gap: 6px;">
                        Connect Wallet 
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                            <path d="M21 18v1a2 2 0 01-2 2H5a2 2 0 01-2-2v-5h18v4zM21 14h-1V8a4 4 0 00-4-4H8a4 4 0 00-4 4v6H3a1 1 0 000 2h1v1a2 2 0 002 2h12a2 2 0 002-2v-1h1a1 1 0 000-2zM6 8a2 2 0 012-2h8a2 2 0 012 2v6H6V8z"/>
                        </svg>
                    </span>
                </button>
                
                <script>
                // Server-based authentication status management
                async function checkAuthStatus() {
                    try {
                        // First check URL parameters for immediate auth status
                        let urlParams = new URLSearchParams(window.location.search);
                        const authSuccess = urlParams.get('auth_success');
                        const sessionId = urlParams.get('session');
                        const username = urlParams.get('username');
                        
                        console.log('🔍 URL Params:', { authSuccess, sessionId, username });
                        
                        if (authSuccess === '1' && sessionId && username) {
                            console.log('✅ Found successful auth in URL, updating UI for:', username);
                            // Store session info for future use
                            localStorage.setItem('sessionId', sessionId);
                            localStorage.setItem('username', username);
                            localStorage.setItem('twitter_connected', 'true');
                            // Update UI immediately (profile image will be fetched in backend check)
                            updateUIForLoggedInUser(username);
                            console.log('🎉 AUTHENTICATION SUCCESS - UI UPDATED!');
                            // Clean up URL
                            window.history.replaceState({}, document.title, window.location.pathname);
                            return;
                        }
                        
                        // Check localStorage for existing session
                        const storedSessionId = localStorage.getItem('sessionId');
                        const storedUsername = localStorage.getItem('username');
                        
                        console.log('🔍 Stored session:', { storedSessionId, storedUsername });
                        
                        if (storedSessionId && storedUsername) {
                            console.log('✅ Using stored session, verifying with backend...');
                            const response = await fetch(`/api/auth-status?session=${storedSessionId}`);
                            const authData = await response.json();
                            console.log('Backend verification:', authData);
                            
                            if (authData.authenticated) {
                                updateUIForLoggedInUser(storedUsername, authData.profile_image_url);
                                return;
                            } else {
                                console.log('❌ Stored session invalid, clearing...');
                                localStorage.removeItem('sessionId');
                                localStorage.removeItem('username');
                            }
                        }
                        
                        // Final check with backend - include session if available from URL
                        const sessionFromUrl = urlParams.get('session');
                        const authUrl = sessionFromUrl ? `/api/auth-status?session=${sessionFromUrl}` : '/api/auth-status';
                        
                        console.log('🔍 Final backend check...', authUrl);
                        const response = await fetch(authUrl);
                        const authData = await response.json();
                        
                        console.log('Final auth check response:', authData);
                        
                        if (authData.authenticated) {
                            console.log('✅ User authenticated, updating UI for:', authData.username);
                            // Store session info for future use
                            localStorage.setItem('sessionId', authData.session_id);
                            localStorage.setItem('username', authData.username);
                            updateUIForLoggedInUser(authData.username || 'Connected', authData.profile_image_url);
                        } else {
                            console.log('❌ User not authenticated, showing login button');
                            updateUIForLoggedOutUser();
                        }
                    } catch (error) {
                        console.error('Auth status check failed:', error);
                        updateUIForLoggedOutUser();
                    }
                }

                function updateUIForLoggedInUser(username, profileImageUrl = null) {
                    console.log('🔄 Updating UI for logged in user:', username);
                    const btn = document.getElementById('main-connect-btn');
                    if (btn) {
                        // Show connected status with username or just "Connected"
                        const displayText = username.startsWith('@') ? username : '@' + username;
                                
                        // Use provided profile image URL or fallback to check mark
                        const profileImg = profileImageUrl ? 
                            `<img src="${profileImageUrl}" style="width: 20px; height: 20px; border-radius: 50%; object-fit: cover;" alt="Profile">` :
                            '<svg width="16" height="16" viewBox="0 0 24 24" fill="white"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>';
                                
                        btn.innerHTML = '<span style="display: flex; align-items: center; gap: 8px; cursor: pointer;">' + profileImg + ' <span style="font-size: 14px;">' + displayText + '</span> <span style="color: rgba(255,255,255,0.7); font-size: 12px; margin-left: 4px;" onclick="event.stopPropagation(); window.location.href=\'/logout\';">&times;</span></span>';
                        btn.style.background = 'linear-gradient(135deg, #065f46, #047857)';
                        btn.style.padding = '8px 16px';
                        btn.onclick = function(e) {
                            e.stopPropagation();
                            toggleProfileDropdown();
                        };
                                
                        // Store in localStorage for consistency
                        localStorage.setItem('twitter_connected', 'true');
                        localStorage.setItem('twitter_handle', username);
                        
                        console.log('✅ UI updated successfully for user:', username);
                    } else {
                        console.log('❌ Button not found!');
                    }
                }
                
                // Run auth check when page loads
                document.addEventListener('DOMContentLoaded', checkAuthStatus);
                
                function updateUIForLoggedOutUser() {
                    const btn = document.getElementById('main-connect-btn');
                    if (btn) {
                        btn.textContent = 'Connect Wallet';
                        btn.style.background = 'linear-gradient(135deg, #1a1a1a, #333333)';
                        btn.style.padding = '10px 20px';
                        btn.onclick = function() {
                            console.log('🔄 Connect Wallet clicked - initializing wallet connection');
                            if (window.walletManager) {
                                window.walletManager.connectWallet();
                            } else {
                                // TypeScript app will handle wallet connection
                                console.log('🔄 TypeScript app should handle this');
                            }
                        };
                    }
                }

                // Also check auth status if returning from OAuth
                window.addEventListener('load', function() {
                    const loadParams = new URLSearchParams(window.location.search);
                    if (loadParams.get('auth_success') === '1' || loadParams.get('emergency') === '1') {
                        console.log('🔄 Detected auth success, checking status...');
                        setTimeout(checkAuthStatus, 100); // Quick check
                    }
                });
                
                // Profile dropdown functionality
                function toggleProfileDropdown() {
                    let dropdown = document.getElementById('profile-dropdown');
                    if (!dropdown) {
                        // Create dropdown if it doesn't exist
                        dropdown = document.createElement('div');
                        dropdown.id = 'profile-dropdown';
                        dropdown.innerHTML = `
                            <div onclick="toggleTheme()" style="padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #374151; color: white; font-size: 14px; display: flex; align-items: center; gap: 8px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span id="theme-toggle-text">Dark Theme</span>
                            </div>
                            <div onclick="window.location.href='/logout'" style="padding: 12px 16px; cursor: pointer; color: white; font-size: 14px; display: flex; align-items: center; gap: 8px;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4M16 17l5-5-5-5M21 12H9" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Sign Out
                            </div>
                        `;
                        dropdown.style.cssText = `
                            position: absolute;
                            top: 100%;
                            right: 0;
                            background: linear-gradient(135deg, #1f2937, #111827);
                            border: 1px solid #374151;
                            border-radius: 8px;
                            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
                            z-index: 1000;
                            min-width: 120px;
                            display: none;
                        `;
                        document.querySelector('.connect-btn').parentElement.style.position = 'relative';
                        document.querySelector('.connect-btn').parentElement.appendChild(dropdown);
                    }
                    
                    // Toggle visibility
                    if (dropdown.style.display === 'block') {
                        dropdown.style.display = 'none';
                    } else {
                        dropdown.style.display = 'block';
                    }
                }
                
                function toggleTheme() {
                    const currentTheme = localStorage.getItem('theme') || 'light';
                    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                    
                    localStorage.setItem('theme', newTheme);
                    document.body.className = newTheme + '-theme';
                    
                    // Update toggle text
                    const toggleText = document.getElementById('theme-toggle-text');
                    if (toggleText) {
                        toggleText.textContent = newTheme === 'dark' ? 'Light Theme' : 'Dark Theme';
                    }
                    
                    // Close dropdown
                    const dropdown = document.getElementById('profile-dropdown');
                    if (dropdown) dropdown.style.display = 'none';
                    
                    console.log('🎨 Theme switched to:', newTheme);
                }
                
                function signOutUser() {
                    // Clear localStorage
                    localStorage.removeItem('twitter_connected');
                    localStorage.removeItem('twitter_handle');
                    localStorage.removeItem('twitter_user_id');
                    localStorage.removeItem('profile_image_url');
                    
                    console.log('🚪 Signed out successfully');
                    
                    // Refresh page to clear any profile data
                    window.location.reload();
                }
                
                // Close dropdown when clicking outside
                document.addEventListener('click', function(e) {
                    const dropdown = document.getElementById('profile-dropdown');
                    const btn = document.querySelector('.connect-btn');
                    if (dropdown && !btn.contains(e.target) && !dropdown.contains(e.target)) {
                        dropdown.style.display = 'none';
                    }
                });
                </script>
                
                <script>
                // Initialize theme on page load
                function initializeTheme() {
                    const savedTheme = localStorage.getItem('theme') || 'light';
                    document.body.className = savedTheme + '-theme';
                    
                    // Update dropdown text if dropdown exists
                    setTimeout(function() {
                        const toggleText = document.getElementById('theme-toggle-text');
                        if (toggleText) {
                            toggleText.textContent = savedTheme === 'dark' ? 'Light Theme' : 'Dark Theme';
                        }
                    }, 100);
                }
                
                // Function to prompt user for their X display name
                function showUserMenu(sessionId) {
                    const menuOptions = [
                        'Refresh Profile Data',
                        'Logout'
                    ];
                    
                    const choice = prompt('What would you like to do?
1. Refresh Profile Data
2. Logout

Enter 1 or 2:');
                    
                    if (choice === '1') {
                        // Refresh profile data
                        console.log('🔄 Refreshing profile data...');
                        fetch('/api/user-session?check_active=1')
                            .then(response => response.json())
                            .then(data => {
                                if (data.success && data.user && data.user.twitter_username) {
                                    const realUsername = data.user.twitter_username;
                                    const profileImage = data.user.profile_image_url || '/static/default-avatar.png';
                                    const btn = document.getElementById('header-auth-btn');
                                    btn.innerHTML = '<span style="display: flex; align-items: center; gap: 8px; cursor: pointer;"><img id="user-avatar" style="width: 24px; height: 24px; border-radius: 50%; border: 2px solid white;" src="' + profileImage + '" alt="Profile"> <span style="font-size: 14px;">' + realUsername + '</span></span>';
                                    localStorage.setItem('twitter_handle', realUsername);
                                    localStorage.setItem('profile_image_url', profileImage);
                                    console.log('✅ Profile refreshed: ' + realUsername);
                                    alert('Profile refreshed successfully!');
                                }
                            }).catch(err => {
                                console.log('Profile refresh failed:', err);
                                alert('Failed to refresh profile data');
                            });
                    } else if (choice === '2') {
                        // Logout
                        if (confirm('Are you sure you want to logout?')) {
                            console.log('👋 Logging out...');
                            window.location.href = '/logout';
                        }
                    }
                }

                // Check authentication state on page load - FORCE FRESH LOAD
                window.addEventListener('DOMContentLoaded', function() {
                    // Initialize theme first
                    initializeTheme();
                    
                    console.log('🚀 PAGE LOADED - FORCE AUTH CHECK');
                    const btn = document.querySelector('.connect-btn');
                    if (btn) {
                        console.log('🔄 FORCE checking for active session...');
                        
                        // ALWAYS check server-side session first - NO CACHE
                        fetch('/api/user-session?check_active=1&t=' + Date.now(), { cache: 'no-cache' })
                            .then(response => response.json())
                            .then(data => {
                                console.log('🔍 FORCE Session check response:', data);
                                
                                if (data.success && data.user && data.user.twitter_username) {
                                    // Found active session - show profile
                                    const realUsername = data.user.twitter_username;
                                    const profileImage = data.user.profile_image_url || '/static/default-avatar.png';
                                    const sessionId = data.session_id;
                                    
                                    console.log('🎉 ACTIVE SESSION FOUND: ' + realUsername);
                                    
                                    btn.innerHTML = '<span style="display: flex; align-items: center; gap: 8px; cursor: pointer;"><img style="width: 24px; height: 24px; border-radius: 50%; border: 2px solid white;" src="' + profileImage + '" alt="Profile"> <span style="font-size: 14px;">' + realUsername + '</span></span>';
                                    btn.style.background = 'linear-gradient(135deg, #1f2937, #111827)';
                                    btn.style.padding = '8px 16px';
                                    btn.disabled = false;
                                    btn.title = 'Profile options';
                                    
                                    btn.onclick = function(e) {
                                        e.stopPropagation();
                                        toggleProfileDropdown();
                                    };
                                    
                                    // Store in localStorage
                                    localStorage.setItem('twitter_connected', 'true');
                                    localStorage.setItem('twitter_handle', realUsername);
                                    localStorage.setItem('twitter_user_id', sessionId);
                                    if (profileImage !== '/static/default-avatar.png') {
                                        localStorage.setItem('profile_image_url', profileImage);
                                    }
                                    
                                    return; // Exit - authenticated state set
                                }
                                
                                // No active session - check URL params for auth completion
                                const launchParams = new URLSearchParams(window.location.search);
                                const authSuccess = launchParams.get('auth_success');
                                const sessionId = launchParams.get('session');
                                const rateLimited = launchParams.get('rate_limited');
                        
                                console.log('🔍 URL Parameters:', { authSuccess, sessionId, rateLimited });
                                
                                if (authSuccess === '1' && sessionId) {
                            // Authentication successful - ALWAYS fetch real profile data
                            console.log('🔄 FORCE Auth success detected, fetching profile data...');
                            
                            // Force fetch real profile data from session API - NO CACHE
                            fetch('/api/user-session?check_active=1&t=' + Date.now(), { cache: 'no-cache' })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.success && data.user && data.user.twitter_username) {
                                        const realUsername = data.user.twitter_username;
                                        const profileImage = data.user.profile_image_url || '/static/default-avatar.png';
                                        btn.innerHTML = '<span style="display: flex; align-items: center; gap: 8px; cursor: pointer;"><img id="user-avatar" style="width: 24px; height: 24px; border-radius: 50%; border: 2px solid white;" src="' + profileImage + '" alt="Profile"> <span style="font-size: 14px;">' + realUsername + '</span></span>';
                                        localStorage.setItem('twitter_handle', realUsername);
                                        localStorage.setItem('profile_image_url', profileImage);
                                        localStorage.setItem('twitter_connected', 'true');
                                        localStorage.setItem('twitter_user_id', sessionId);
                                        
                                        btn.style.background = 'linear-gradient(135deg, #1f2937, #111827)';
                                        btn.style.padding = '8px 16px';
                                        btn.disabled = false;
                                        
                                        console.log('✅ Real X profile loaded: ' + realUsername);
                                        if (profileImage !== '/static/default-avatar.png') {
                                            console.log('✅ Profile picture loaded: ' + profileImage);
                                        }
                                        
                                        // Clean URL without refreshing page
                                        const newUrl = window.location.pathname;
                                        window.history.replaceState({}, document.title, newUrl);
                                        return; // Exit early since we got real data
                                    }
                                }).catch(err => console.log('Profile fetch failed:', err));
                                } else {
                                    // No authentication - show Connect button
                                    console.log('❌ No active session - showing Connect button');
                                    btn.innerHTML = '<span style="display: flex; align-items: center; gap: 6px;">Connect <svg width="16" height="16" viewBox="0 0 24 24" style="margin-top: -1px;"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" fill="white"/></svg></span>';
                                    btn.style.background = 'linear-gradient(135deg, #6b7280, #4b5563)';
                                    btn.disabled = false;
                                    btn.onclick = function() { window.location.href = '/auth/twitter'; };
                                }
                            }).catch(err => {
                                console.log('❌ Session check failed:', err);
                                // Show Connect button on error
                                btn.innerHTML = '<span style="display: flex; align-items: center; gap: 6px;">Connect <svg width="16" height="16" viewBox="0 0 24 24" style="margin-top: -1px;"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" fill="white"/></svg></span>';
                                btn.style.background = 'linear-gradient(135deg, #6b7280, #4b5563)';
                                btn.disabled = false;
                                btn.onclick = connectWithX;
                            });
                            
                            // Fallback if profile fetch fails - removed problematic undefined variable
                            btn.style.background = 'linear-gradient(135deg, #1f2937, #111827)';
                            btn.style.padding = '8px 16px';
                            btn.disabled = false; // Enable for sign out
                            btn.title = 'Click to set your X username';
                            
                            // Store connection state
                            localStorage.setItem('twitter_connected', 'true');
                            localStorage.setItem('twitter_handle', userHandle);
                            localStorage.setItem('twitter_user_id', sessionId);
                            
                            console.log(`✅ Connected as ${statusText}`);
                            
                            // Add click functionality to update display name
                            btn.onclick = function(e) {
                                e.stopPropagation();
                                showUserMenu(sessionId);
                            };
                            
                            // Fetch and display profile data
                            fetchAndDisplayProfile(sessionId, userHandle);
                            
                            // Clean URL without refreshing page
                            const newUrl = window.location.pathname;
                            window.history.replaceState({}, document.title, newUrl);
                        } else {
                            // Check if already connected from previous session
                            const isConnected = localStorage.getItem('twitter_connected') === 'true';
                            const storedHandle = localStorage.getItem('twitter_handle');
                            const storedUserId = localStorage.getItem('twitter_user_id');
                            
                            if (isConnected && storedHandle && storedUserId) {
                                // Already connected - show connected state with avatar and sign out option
                                const storedProfileImage = localStorage.getItem('profile_image_url') || '/static/default-avatar.png';
                                btn.innerHTML = '<span style="display: flex; align-items: center; gap: 8px;"><img id="user-avatar" style="width: 24px; height: 24px; border-radius: 50%; border: 2px solid white;" src="' + storedProfileImage + '" alt="Profile"> <span style="font-size: 14px;">' + storedHandle + '</span></span>';
                                btn.style.background = 'linear-gradient(135deg, #1f2937, #111827)';
                                btn.style.padding = '8px 16px';
                                btn.disabled = false; // Enable for sign out
                                btn.title = 'Profile options';
                                console.log(`✅ Already connected as ${storedHandle}`);
                                
                                // Add dropdown functionality
                                btn.onclick = function(e) {
                                    e.stopPropagation();
                                    toggleProfileDropdown();
                                };
                                
                                // Fetch and display profile data
                                fetchAndDisplayProfile(storedUserId, storedHandle);
                            } else {
                                // Check for active server session first
                                fetch('/api/user-session?check_active=1', {
                                    method: 'GET',
                                    credentials: 'include'
                                }).then(response => response.json())
                                .then(data => {
                                    if (data.success && data.user && data.user.twitter_username) {
                                        // Active session found - show real profile
                                        const realUsername = data.user.twitter_username;
                                        const sessionId = data.user.twitter_user_id;
                                        
                                        const profileImage = data.user.profile_image_url || '/static/default-avatar.png';
                                        btn.innerHTML = '<span style="display: flex; align-items: center; gap: 8px; cursor: pointer;"><img id="user-avatar" style="width: 24px; height: 24px; border-radius: 50%; border: 2px solid white;" src="' + profileImage + '" alt="Profile"> <span style="font-size: 14px;">' + realUsername + '</span></span>';
                                        localStorage.setItem('profile_image_url', profileImage);
                                        btn.style.background = 'linear-gradient(135deg, #1f2937, #111827)';
                                        btn.style.padding = '8px 16px';
                                        btn.disabled = false;
                                        btn.title = 'Click to update username or sign out';
                                        
                                        btn.onclick = function(e) {
                                            e.stopPropagation();
                                            showUserMenu(sessionId);
                                        };
                                        
                                        // Store in localStorage
                                        localStorage.setItem('twitter_connected', 'true');
                                        localStorage.setItem('twitter_handle', realUsername);
                                        localStorage.setItem('twitter_user_id', sessionId);
                                        
                                        console.log('✅ Active session restored: ' + realUsername);
                                    } else {
                                        // Not connected - show connect button
                                        btn.innerHTML = '<span style="display: flex; align-items: center; gap: 6px;">Connect <svg width="16" height="16" viewBox="0 0 24 24" style="margin-top: -1px;"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" fill="white"/></svg></span>';
                                        btn.style.background = 'linear-gradient(135deg, #6b7280, #4b5563)';
                                        btn.disabled = false;
                                        btn.onclick = function() { 
                                            if (window.socialXApp && window.socialXApp.showThirdwebModal) {
                                                window.socialXApp.showThirdwebModal();
                                            } else {
                                                console.log('🔄 Thirdweb modal not ready, using fallback');
                                            }
                                        };
                                        console.log('🔄 Header button reset - ready for real OAuth');
                                    }
                                }).catch(err => {
                                    console.log('Session check failed:', err);
                                    // Not connected - show connect button
                                    btn.innerHTML = '<span style="display: flex; align-items: center; gap: 6px;">Connect Wallet <svg width="16" height="16" viewBox="0 0 24 24" style="margin-top: -1px;"><path d="M21 18v1a2 2 0 01-2 2H5a2 2 0 01-2-2v-5h18v4z"/></svg></span>';
                                    btn.style.background = 'linear-gradient(135deg, #6b7280, #4b5563)';
                                    btn.disabled = false;
                                    btn.onclick = function() { 
                                        if (window.socialXApp && window.socialXApp.showThirdwebModal) {
                                            window.socialXApp.showThirdwebModal();
                                        } else {
                                            console.log('🔄 Thirdweb modal not ready, using fallback');
                                        }
                                    };
                                    console.log('🔄 Header button reset - ready for thirdweb modal');
                                });
                            }
                        }
                    }
                });
                </script>
            </div>
        </div>
    </header>
    
    <nav class="bottom-nav">
        <a href="#" onclick="navigateToPage('/markets')" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" width="20" height="20">
                <path d="M3 13h2l3-9 4 9 4-4 2 4h3" stroke="currentColor" stroke-width="2" fill="none"/>
            </svg>
            <span class="nav-label">Markets</span>
        </a>
        <a href="#" onclick="navigateToPage('/portfolio')" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" width="20" height="20">
                <path d="M20,6H16V4C16,2.89 15.11,2 14,2H10C8.89,2 8,2.89 8,4V6H4C2.89,6 2.01,6.89 2.01,8L2,19C2,20.11 2.89,21 4,21H20C21.11,21 22,20.11 22,19V8C22,6.89 21.11,6 20,6M10,4H14V6H10V4M20,19H4V8H20V19Z" fill="currentColor"/>
            </svg>
            <span class="nav-label">Portfolio</span>
        </a>
        <a href="#" onclick="navigateToPage('/launch')" class="nav-item">
            <svg class="nav-icon" viewBox="0 0 24 24" width="20" height="20">
                <path d="M13.13 22.19L11.5 18.36C13.07 17.78 14.54 17 15.9 16.09L13.13 22.19M5.64 12.5L1.81 10.87L7.91 8.1C7 9.46 6.22 10.93 5.64 12.5M21.61 2.39C21.61 2.39 16.66.269 11 5.93C8.81 8.12 7.5 10.53 6.65 12.64C6.37 13.39 6.56 14.21 7.11 14.77L9.24 16.89C9.79 17.45 10.61 17.63 11.36 17.35C13.5 16.53 15.88 15.19 18.07 13C23.73 7.34 21.61 2.39 21.61 2.39M14.54 9.46C13.76 8.68 13.76 7.41 14.54 6.63S16.59 5.85 17.37 6.63C18.14 7.41 18.15 8.68 17.37 9.46C16.59 10.24 15.32 10.24 14.54 9.46M8.88 16.53L7.47 15.12L8.88 16.53M6.24 22L9.88 18.36C9.54 18.27 9.21 18.12 8.91 17.91L4.83 22H6.24M2 22H3.41L8.18 17.24L6.76 15.83L2 20.59V22M2 19.17L6.09 15.09C5.88 14.79 5.73 14.47 5.64 14.12L2 17.76V19.17Z" fill="currentColor"/>
            </svg>
            <span class="nav-label">Launch</span>
        </a>
    </nav>
    
    <div class="container">
        <h1>Launch Your Account</h1>
        
        <div class="launch-section">
            <div class="notice" id="auth-notice">Connect Your Twitter</div>
        </div>
        
        <div class="launch-section">
            <h2>Launch Your Account</h2>
            <div id="launch-controls">
                <button id="launch-account-btn" class="launch-btn" disabled>Launch Account</button>
                <div id="launch-status"></div>
            </div>
        </div>
    </div>
    
    <style>
        .launch-section {
            margin: 24px 0;
            padding: 28px;
            border: 1px solid #e1e5e9;
            border-radius: 16px;
            background: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.02);
        }
        .launch-btn {
            background: #1a1a1a;
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 500;
            margin: 12px 0;
            transition: all 0.2s ease;
        }
        .launch-btn:hover:not(:disabled) {
            background: #333;
            transform: translateY(-1px);
        }
        .launch-btn:disabled {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }
        .profile-card {
            border: 1px solid #e1e5e9;
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            background: #f8fafc;
        }
        .profile-card div {
            margin: 8px 0;
            color: #374151;
        }
        .status-message {
            padding: 16px;
            margin: 12px 0;
            border-radius: 12px;
            font-size: 14px;
        }
        .success { background: #f0fdf4; color: #166534; border: 1px solid #bbf7d0; }
        .error { background: #fef2f2; color: #dc2626; border: 1px solid #fecaca; }
        .info { background: #f0f9ff; color: #0369a1; border: 1px solid #bae6fd; }
        .notice {
            text-align: center;
            color: #6b7280;
            font-size: 14px;
            font-weight: 500;
            opacity: 0.8;
        }
    </style>
    
    <script>
        function navigateToPage(path) {
            window.location.href = path;
        }
        
        // Check for authentication errors in URL and clear localStorage if needed
        let urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('error') === 'no_token' || urlParams.get('error') === 'callback_failed') {
            console.log('❌ Authentication error detected - clearing localStorage');
            localStorage.removeItem('twitter_connected');
            localStorage.removeItem('twitter_handle');
            localStorage.removeItem('twitter_user_id');
            
            // Clear URL parameters by replacing current state
            const cleanUrl = window.location.pathname;
            window.history.replaceState({}, document.title, cleanUrl);
        }
        
        // Check if user is connected and get their real profile data
        const isConnected = localStorage.getItem('twitter_connected') === 'true';
        const storedHandle = localStorage.getItem('twitter_handle');
        const storedUserId = localStorage.getItem('twitter_user_id');
        
        let profileData = null;
        
        // Re-check connection status after potential cleanup
        const finalConnected = localStorage.getItem('twitter_connected') === 'true';
        const finalHandle = localStorage.getItem('twitter_handle');
        const finalUserId = localStorage.getItem('twitter_user_id');
        
        if (finalConnected && finalHandle && finalUserId) {
            profileData = {
                success: true,
                handle: finalHandle,
                user_id: finalUserId,
                name: finalHandle.replace('@', ''),
                real_oauth: true
            };
            
            // Hide the "Connect Your Twitter" section and enable launch button
            document.querySelector('.notice').textContent = `Connected as ${finalHandle}`;
            document.querySelector('.notice').style.color = '#16a34a';
            document.getElementById('launch-account-btn').disabled = false;
            document.getElementById('launch-account-btn').style.background = '#1a1a1a';
            document.getElementById('launch-account-btn').style.cursor = 'pointer';
        } else {
            // Show connection requirement
            document.querySelector('.notice').textContent = 'Please connect your Twitter account to launch';
            document.querySelector('.notice').style.color = '#dc2626';
            document.getElementById('launch-account-btn').disabled = true;
            document.getElementById('launch-account-btn').style.background = '#9ca3af';
            document.getElementById('launch-account-btn').style.cursor = 'not-allowed';
        }
        
        document.getElementById('launch-account-btn').addEventListener('click', async function() {
            if (!profileData) return;
            
            try {
                // Step 1: Launch Account
                this.textContent = 'Preparing account...';
                this.disabled = true;
                
                document.getElementById('launch-status').innerHTML = 
                    '<div class="status-message info">Step 1: Preparing account structure...</div>';
                
                const launchResponse = await fetch('/api/launch-account', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(profileData)
                });
                
                const launchData = await launchResponse.json();
                
                if (!launchData.success) {
                    throw new Error(launchData.error || 'Failed to prepare account');
                }
                
                // Step 2: Deploy Contract
                this.textContent = 'Deploying contract...';
                
                document.getElementById('launch-status').innerHTML = 
                    '<div class="status-message info">Step 2: Deploying smart contract to HyperEVM...</div>';
                
                const deployResponse = await fetch('/api/deploy-contract', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(profileData)
                });
                
                const deployData = await deployResponse.json();
                
                if (deployData.success) {
                    document.getElementById('launch-status').innerHTML = 
                        `<div class="status-message success">
                            🎉 Account launched successfully!<br>
                            <strong>Contract Address:</strong> ${deployData.contract_address || 'N/A'}<br>
                            <strong>Transaction Hash:</strong> ${deployData.transaction_hash || 'N/A'}<br>
                            <strong>Network:</strong> HyperEVM Mainnet
                        </div>`;
                    this.textContent = 'Account Launched ✓';
                    this.style.background = '#1a1a1a';
                } else {
                    throw new Error(deployData.error || 'Failed to deploy contract');
                }
            } catch (error) {
                console.error('Launch error:', error);
                document.getElementById('launch-status').innerHTML = 
                    `<div class="status-message error">Launch failed: ${error.message}</div>`;
                this.textContent = 'Launch Failed - Try Again';
                this.disabled = false;
                this.style.background = '#1a1a1a';
            }
        });
        
        
        console.log('🚀 Launch Page Loaded');
    </script>
    <script>
        // Embedded Thirdweb Modal - Works immediately!
        console.log('🚀 Thirdweb integration starting...');

        function showThirdwebModal() {
            const modal = document.createElement('div');
            modal.innerHTML = 
                '<div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 10000; backdrop-filter: blur(8px);">' +
                    '<div style="background: #1a1a1a; padding: 32px; border-radius: 24px; max-width: 400px; width: 90%; color: white; font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', sans-serif;">' +
                        '<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">' +
                            '<h2 style="margin: 0; font-size: 24px; font-weight: 600;">Sign in</h2>' +
                            '<button id="close-modal" style="background: none; border: none; color: #888; font-size: 24px; cursor: pointer;">&times;</button>' +
                        '</div>' +
                        '<div style="display: flex; gap: 12px; margin-bottom: 24px; justify-content: center;">' +
                            '<button class="social-btn" data-provider="google" style="width: 56px; height: 56px; border-radius: 12px; border: 1px solid #333; background: #2a2a2a; cursor: pointer; display: flex; align-items: center; justify-content: center;">G</button>' +
                            '<button class="social-btn" data-provider="discord" style="width: 56px; height: 56px; border-radius: 12px; border: 1px solid #333; background: #2a2a2a; cursor: pointer; display: flex; align-items: center; justify-content: center;">D</button>' +
                            '<button class="social-btn" data-provider="telegram" style="width: 56px; height: 56px; border-radius: 12px; border: 1px solid #333; background: #2a2a2a; cursor: pointer; display: flex; align-items: center; justify-content: center;">T</button>' +
                            '<button class="social-btn" data-provider="farcaster" style="width: 56px; height: 56px; border-radius: 12px; border: 1px solid #333; background: #2a2a2a; cursor: pointer; display: flex; align-items: center; justify-content: center;">F</button>' +
                            '<button class="social-btn" data-provider="x" style="width: 56px; height: 56px; border-radius: 12px; border: 1px solid #333; background: #2a2a2a; cursor: pointer; display: flex; align-items: center; justify-content: center;">X</button>' +
                        '</div>' +
                        '<input id="email-input" type="email" placeholder="Email address" style="width: 100%; padding: 16px; border: 1px solid #333; border-radius: 12px; background: #2a2a2a; color: white; font-size: 16px; outline: none; box-sizing: border-box; margin-bottom: 16px;">' +
                        '<button class="social-btn" data-provider="phone" style="width: 100%; padding: 16px; border: 1px solid #0052ff; border-radius: 12px; background: transparent; color: #0052ff; cursor: pointer; display: flex; align-items: center; gap: 12px; font-size: 16px; margin-bottom: 12px;">📱 Phone number</button>' +
                        '<button class="social-btn" data-provider="passkey" style="width: 100%; padding: 16px; border: 1px solid #333; border-radius: 12px; background: #2a2a2a; color: white; cursor: pointer; display: flex; align-items: center; gap: 12px; font-size: 16px; margin-bottom: 24px;">🔐 Passkey</button>' +
                        '<div style="text-align: center; color: #666; margin: 24px 0; font-size: 14px;">OR</div>' +
                        '<button id="connect-wallet-btn" style="width: 100%; padding: 16px; border: 1px solid #333; border-radius: 12px; background: #2a2a2a; color: white; cursor: pointer; display: flex; align-items: center; gap: 12px; font-size: 16px; margin-bottom: 24px;">💼 Connect a Wallet</button>' +
                        '<div style="text-align: center; color: #666; font-size: 12px;">Powered by 🛡️ <strong>thirdweb</strong></div>' +
                    '</div>' +
                '</div>';
            document.body.appendChild(modal);
            
            // Social buttons
            modal.querySelectorAll('.social-btn').forEach(btn => {
                btn.addEventListener('mouseenter', () => btn.style.transform = 'scale(1.05)');
                btn.addEventListener('mouseleave', () => btn.style.transform = 'scale(1)');
                btn.addEventListener('click', () => {
                    const provider = btn.getAttribute('data-provider');
                    modal.remove();
                    if (provider) {
                        alert('🌟 ' + provider.charAt(0).toUpperCase() + provider.slice(1) + ' login selected!\n\n✅ This connects via thirdweb social auth\n🚀 For now, using Web3 wallet...');
                        connectWeb3();
                    }
                });
            });
            
            // Connect wallet
            modal.getElementById('connect-wallet-btn').addEventListener('click', () => {
                modal.remove();
                connectWeb3();
            });
            
            // Close modal
            modal.getElementById('close-modal').addEventListener('click', () => modal.remove());
        }
        
        async function connectWeb3() {
            try {
                if (typeof window.ethereum === 'undefined') {
                    alert('🦊 No Web3 wallet found!\n\nInstall MetaMask: https://metamask.io');
                    return;
                }
                
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                if (accounts.length > 0) {
                    const address = accounts[0];
                    const shortAddress = address.slice(0,6) + '...' + address.slice(-4);
                    
                    const btn = document.getElementById('main-connect-btn');
                    if (btn) {
                        btn.innerHTML = '<span style="display: flex; align-items: center; gap: 6px;">🦊 ' + shortAddress + ' <span style="color: rgba(255,255,255,0.7); cursor: pointer;" onclick="disconnect()">&times;</span></span>';
                        btn.style.background = 'linear-gradient(135deg, #0064C8, #4A9EFF)';
                        btn.onclick = () => alert('✅ Connected!\n\n🔗 Address: ' + address + '\n🌍 Network: HyperEVM ready\n🚀 Thirdweb social login available!');
                    }
                    
                    // Switch to HyperEVM
                    try {
                        await window.ethereum.request({
                            method: 'wallet_addEthereumChain',
                            params: [{
                                chainId: '0x3E7',
                                chainName: 'HyperEVM',
                                nativeCurrency: { name: 'HYPE', symbol: 'HYPE', decimals: 18 },
                                rpcUrls: ['https://rpc.hyperevm.org']
                            }]
                        });
                        console.log('✅ HyperEVM added');
                    } catch (e) {
                        console.log('⚠️ HyperEVM add failed:', e.message);
                    }
                }
            } catch (error) {
                console.error('Connection failed:', error);
                alert('Connection failed. Make sure your wallet is unlocked.');
            }
        }
        
        function disconnect() {
            const btn = document.getElementById('main-connect-btn');
            if (btn) {
                btn.innerHTML = '<span style="display: flex; align-items: center; gap: 6px;">Connect Wallet <svg width="16" height="16" viewBox="0 0 24 24" fill="white"><path d="M21 18v1a2 2 0 01-2 2H5a2 2 0 01-2-2v-5h18v4z"/></svg></span>';
                btn.style.background = 'linear-gradient(135deg, #1a1a1a, #333333)';
                btn.onclick = showThirdwebModal;
            }
        }

        // Initialize after page loads
        setTimeout(() => {
            const btn = document.getElementById('main-connect-btn');
            if (btn) {
                btn.onclick = showThirdwebModal;
                console.log('✅ Thirdweb modal ready! No more loading messages.');
                
                // Remove any loading messages
                const loadingMsg = document.querySelector('div[style*="Wallet system is loading"]');
                if (loadingMsg) loadingMsg.remove();
            }
        }, 200);
        
        // Make disconnect global
        window.disconnect = disconnect;
    </script>
    <script src="/simple-wallet.js"></script>
    <script src="/app.js"></script>
</body>
</html>
